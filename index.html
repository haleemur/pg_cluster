<!DOCTYPE html>
<html>
  <head>
    <title>PostgreSQL Streaming Replication</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# HackDay Project


## Setting up PostgreSQL Replication

        by Haleemur Ali

---

# PostgreSQL Replication

The goal is to set up a master - slave replication using the latest and greatest PostgreSQL (version 9.5).

The stretch goal is to also set up a connection pool that does load balancing and automatic failover.

## Good News

PostgreSQL comes built in with replication (since version 9.0). *streaming asynchronous
master - slave replication*

## Bad News

Requires fungling with the configuration. *I wish there was sample replication config file. No, but
there are plenty of blogs with their opinionated and slightly varying configuration options to set 
up postgres replication*

---

# Why do we need a cluster?

Put data faster into the database

Serve more people who query the database

Run queries faster

Safeguard against the the server crashing

Scale out as our data volume increases

---

# What is a load balancer?

A load balancer cycles through a list of workers, and distributes work between them,
so that individual are not overwhelmed.

There are many good load balancers for PostgreSQL:

The solution I'm using here is called [Pgpool-II](http://pgpool.net/mediawiki/index.php/Main_Page).

Its developed by a Japanese company, so English documentation is sparse :(

The load balancer connects to each node in the cluster, and decides which node gets to
handle an incoming request.

---


# What is Streaming Replication?

PostgreSQL uses something called WAL (write ahead log).

Every time a transaction is committed, it is written to
the WAL. If the server crashes, it can be rebuilt by replaying the WAL from scratch, or since the last backup.

## Crazy Idea:

What if we ship the logs to another computer running a PostgreSQL server and have it constantly restore
the backup.

__Us__: *'Sup Computer! Can you restore this PostgreSQL server for me. here's the backup I made last week, and here are some logs.*

__Backup Machine__: *There you go, backup restored, need anything else?*

__Us__: *Oh yeah, forgot these last bits WAL records. Be a peach and stack them on, will ya*

... and so on and so on.

---

class: center, middle

# Live Demo

---

class: center, middle

# END

    </textarea>
    <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>